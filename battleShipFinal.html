<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Ships</title>
    <style>
        #battleShips {
            border: 2px solid;
            width: 500px;
            height: 400px;
        }

        #battleShipsTwo {
            border: 2px solid;
            width: 500px;
            height: 400px;
        }

        #battleShips th, #battleShips td {
            border: 2px solid;
            padding: 20px;
        }

        #battleShipsTwo th, #battleShipsTwo td {
            border: 2px solid;
            padding: 20px;
        }

        #rotateBtn {
            height: 100px;
            width: 150px;
            font-size: x-large;
            float: right;
        }

        #rematch {
            height: 100px;
            width: 150px;
            font-size: x-large;
            float: left;
        }

        .instructions {
            font-size: x-large;
            text-align: center;
            margin: 0 auto;
            width: 50%;
        }

        .white {
            background-color: white;
            background: white;
        }

        .pink {
            background-color: pink;
        }

        .blue {
            background-color: blue;
        }

        .orange {
            background-color: orange;
        }

        .gray {
            background-color: gray;
        }

        .table-container {
            display: flex;
            justify-content: space-around;
        }

        .title {
            font-size: 20px;
        }

        .container {
            display: flex;
            justify-content: space-around;
            align-items: center;

        }

    </style>
    <script src="gamePlan.js"></script>
</head>
<body>

    <div class="container">
        <p class="title">Player One</p>
        <p class="title">Player Two</p>
    </div>

    <div class="table-container">
    <table id="battleShips" tabindex="0">
        <thead>
            <tr>
                <th></th>
                <th>A</th>
                <th>B</th>
                <th>C</th>
                <th>D</th>
                <th>E</th>
                <th>F</th>
                <th>G</th>
                <th>H</th>
                <th>I</th>
                <th>J</th>
            </tr>
        </thead>
        <tbody>
            <tr id="header-1">
                <th>1</th>
                <td>A1</td>
                <td>B1</td>
                <td>C1</td>
                <td>D1</td>
                <td>E1</td>
                <td>F1</td>
                <td>G1</td>
                <td>H1</td>
                <td>I1</td>
                <td>J1</td>
            </tr>
            <tr id="header-2">
                <th>2</th>
                <td>A2</td>
                <td>B2</td>
                <td>C2</td>
                <td>D2</td>
                <td>E2</td>
                <td>F2</td>
                <td>G2</td>
                <td>H2</td>
                <td>I2</td>
                <td>J2</td>
            </tr>
            <tr id="header-3">
                <th>3</th>
                <td>A3</td>
                <td>B3</td>
                <td>C3</td>
                <td>D3</td>
                <td>E3</td>
                <td>F3</td>
                <td>G3</td>
                <td>H3</td>
                <td>I3</td>
                <td>J3</td>
            </tr>
            <tr id="header-4">
                <th>4</th>
                <td>A4</td>
                <td>B4</td>
                <td>C4</td>
                <td>D4</td>
                <td>E4</td>
                <td>F4</td>
                <td>G4</td>
                <td>H4</td>
                <td>I4</td>
                <td>J4</td>
            </tr>
            <tr id="header-5">
                <th>5</th>
                <td>A5</td>
                <td>B5</td>
                <td>C5</td>
                <td>D5</td>
                <td>E5</td>
                <td>F5</td>
                <td>G5</td>
                <td>H5</td>
                <td>I5</td>
                <td>J5</td>
            </tr>
            <tr id="header-6">
                <th>6</th>
                <td>A6</td>
                <td>B6</td>
                <td>C6</td>
                <td>D6</td>
                <td>E6</td>
                <td>F6</td>
                <td>G6</td>
                <td>H6</td>
                <td>I6</td>
                <td>J6</td>
            </tr>
            <tr id="header-7">
                <th>7</th>
                <td>A7</td>
                <td>B7</td>
                <td>C7</td>
                <td>D7</td>
                <td>E7</td>
                <td>F7</td>
                <td>G7</td>
                <td>H7</td>
                <td>I7</td>
                <td>J7</td>
            </tr>
            <tr id="header-8">
                <th>8</th>
                <td>A8</td>
                <td>B8</td>
                <td>C8</td>
                <td>D8</td>
                <td>E8</td>
                <td>F8</td>
                <td>G8</td>
                <td>H8</td>
                <td>I8</td>
                <td>J8</td>
            </tr>
            <tr id="header-9">
                <th>9</th>
                <td>A9</td>
                <td>B9</td>
                <td>C9</td>
                <td>D9</td>
                <td>E9</td>
                <td>F9</td>
                <td>G9</td>
                <td>H9</td>
                <td>I9</td>
                <td>J9</td>
            </tr>
            <tr id="header-10">
                <th>10</th>
                <td>A10</td>
                <td>B10</td>
                <td>C10</td>
                <td>D10</td>
                <td>E10</td>
                <td>F10</td>
                <td>G10</td>
                <td>H10</td>
                <td>I10</td>
                <td>J10</td>
            </tr>
        </tbody>
    </table>
        <div><p></p></div>
    <table id="battleShipsTwo" tabindex="0">
        <thead>
            <tr>
                <th></th>
                <th>A</th>
                <th>B</th>
                <th>C</th>
                <th>D</th>
                <th>E</th>
                <th>F</th>
                <th>G</th>
                <th>H</th>
                <th>I</th>
                <th>J</th>
            </tr>
        </thead>
        <tbody>
            <tr id="footer-1">
                <th>1</th>
                <td>A1</td>
                <td>B1</td>
                <td>C1</td>
                <td>D1</td>
                <td>E1</td>
                <td>F1</td>
                <td>G1</td>
                <td>H1</td>
                <td>I1</td>
                <td>J1</td>
            </tr>
            <tr id="footer-2">
                <th>2</th>
                <td>A2</td>
                <td>B2</td>
                <td>C2</td>
                <td>D2</td>
                <td>E2</td>
                <td>F2</td>
                <td>G2</td>
                <td>H2</td>
                <td>I2</td>
                <td>J2</td>
            </tr>
            <tr id="footer-3">
                <th>3</th>
                <td>A3</td>
                <td>B3</td>
                <td>C3</td>
                <td>D3</td>
                <td>E3</td>
                <td>F3</td>
                <td>G3</td>
                <td>H3</td>
                <td>I3</td>
                <td>J3</td>
            </tr>
            <tr id="footer-4">
                <th>4</th>
                <td>A4</td>
                <td>B4</td>
                <td>C4</td>
                <td>D4</td>
                <td>E4</td>
                <td>F4</td>
                <td>G4</td>
                <td>H4</td>
                <td>I4</td>
                <td>J4</td>
            </tr>
            <tr id="footer-5">
                <th>5</th>
                <td>A5</td>
                <td>B5</td>
                <td>C5</td>
                <td>D5</td>
                <td>E5</td>
                <td>F5</td>
                <td>G5</td>
                <td>H5</td>
                <td>I5</td>
                <td>J5</td>
            </tr>
            <tr id="footer-6">
                <th>6</th>
                <td>A6</td>
                <td>B6</td>
                <td>C6</td>
                <td>D6</td>
                <td>E6</td>
                <td>F6</td>
                <td>G6</td>
                <td>H6</td>
                <td>I6</td>
                <td>J6</td>
            </tr>
            <tr id="footer-7">
                <th>7</th>
                <td>A7</td>
                <td>B7</td>
                <td>C7</td>
                <td>D7</td>
                <td>E7</td>
                <td>F7</td>
                <td>G7</td>
                <td>H7</td>
                <td>I7</td>
                <td>J7</td>
            </tr>
            <tr id="footer-8">
                <th>8</th>
                <td>A8</td>
                <td>B8</td>
                <td>C8</td>
                <td>D8</td>
                <td>E8</td>
                <td>F8</td>
                <td>G8</td>
                <td>H8</td>
                <td>I8</td>
                <td>J8</td>
            </tr>
            <tr id="footer-9">
                <th>9</th>
                <td>A9</td>
                <td>B9</td>
                <td>C9</td>
                <td>D9</td>
                <td>E9</td>
                <td>F9</td>
                <td>G9</td>
                <td>H9</td>
                <td>I9</td>
                <td>J9</td>
            </tr>
            <tr id="footer-10">
                <th>10</th>
                <td>A10</td>
                <td>B10</td>
                <td>C10</td>
                <td>D10</td>
                <td>E10</td>
                <td>F10</td>
                <td>G10</td>
                <td>H10</td>
                <td>I10</td>
                <td>J10</td>
            </tr>
        </tbody>
    </table>
    </div>
    <div>
        <h2 class="instructions">
            To play the game, use arrow keys to place ships on your respective board.
            Click on the table headings to focus on the board in order to place your ships.
            Clicking other buttons such as 'Play Again' or 'rotate' causes the boards to lose focus.
            Simply click the tables again to regain focus in order to place ships.
    
            Player One starts. To Rotate the ship placement, click the rotate button. 
            Once 5 ships are placed, it is time for Player Two to place their ships.

            Press 'ENTER' to place ship.
        </h2>
    </div>

    <div>
        <button id="rotateBtn" type="button" style="font-size: large;">
            rotate
        </button>


        <button id="rematch" type="button" style="font-size: large;">
            Play Again?
        </button>
    </div>
    <div class="container">
        <p id="hitOrmiss" class="title">test</p>
    </div>
    <script>
        // Global Variables
        let turn = true;
        let shift = false;
        let playerTwoTurn = false;
        let activeTable = "tableOne";

        const coords = {
            "Carrier":      [],
            "Battleship":   [],
            "Destroyer":    [],
            "Submarine":    [],
            "Patrol":       [],
        }

        const shipCoordinates = {
            "Carrier":      [],
            "BattleShip":   [],
            "Destroyer":    [],
            "Submarine":    [],
            "Patrol":       [],
        };
        
        let deleteShip = false;

        const playerOne = new Gameboard();
        const playerTwo = new Gameboard();

        console.log(playerOne, playerTwo, "begininning");

        playerOne.htmlID = "battleShips";
        playerTwo.htmlID = "battleShipsTwo";

        playerOne.createBoardGame();
        playerTwo.createBoardGame();

        playerOne.place();
        playerTwo.place();

        function hide(ID){
            const table = document.getElementById(ID);
            const cells = table.getElementsByTagName("td");
            
            Array.from(cells).forEach(cell => {
                cell.classList.add('gray');
            });
        }

        function myFunc(e){
            // change this function to only work
            // after all ships have been placed
            // playerOne.gameOver();
            // playerTwo.gameOver();

            if (!playerTwo.gameSet) {
                return
            }

            if (playerOne.allOver) {
                return
            }
            
            if (playerTwo.allOver) {
                return
            }

            console.log(e.toElement, e);
            if (!(e.target.nodeName === "TD")) {
                return
            }

            if (!turn && e.target.parentElement.id.split("-")[0] === "header") { 
                turn = true;
            } else if (turn && e.target.parentElement.id.split("-")[0] === "footer") {
                turn = false;
            } else {
                console.log(turn, "..no?...");
                return;
            }

            // const location = new Position();
            const depth = e.target.parentElement.id.split("-");
            // e.target.style.backgroundColor = "orange"; // CODE HERE
            e.target.classList.add("orange"); // CODE HERE
            console.log(e, e.target.color, depth[0]);
            let currentBoard = "";
            let opponent = "";

            if (depth[0] === "header") {
                currentBoard = playerOne;
                currentBoard.name = "Player One";
                opponent = playerTwo;
            } else if (depth[0] === "footer") {
                currentBoard = playerTwo;
                currentBoard.name = "Player Two";
                opponent = playerOne;
            }

            const tableTop = document.getElementById(currentBoard.htmlID);
            const cells = tableTop.getElementsByTagName("td");

            const enemyTable = document.getElementById(opponent.htmlID);
            const enemyCells = enemyTable.getElementsByTagName("td");
            
            setTimeout(() => {
                console.log("Opponent Attacking");
                Array.from(cells).forEach(cell => {
                cell.classList.remove('gray');
            });
            }, 2000)
            // Array.from(cells).forEach(cell => {
            //     cell.classList.remove('gray');
            // });

            Array.from(enemyCells).forEach(cell => {
                cell.classList.add('gray');
            });

            // e.target.classList.add("orange");
            // currentBoard.gameOver();
            // console.log(currentBoard.board, currentBoard.allOver, "game done?");

            // if (currentBoard.allOver) {
            //     window.alert(`${currentBoard.name} loses`);
            // }
            // // currentBoard.gameOver();

            // console.log(currentBoard.currentShips(), currentBoard.allOver);

            // if (currentBoard.allOver) {
            //     console.log(`${currentBoard.name} loses`);
            //     window.alert(`${currentBoard.name} loses`)
            // }

            // start coding from HERE!
            // create reference to removeShip function 
            // which will pop off the coord for the ship object
            // removeShip(currentBoard.coordinates, e.target.innerText)

            currentBoard.board[e.target.innerText].hit = true;
            console.log(`Position ${e.target.innerText} has been hit!`);

            
        
            for (ship of Object.keys(currentBoard.coordinates)) {

                const index = currentBoard.coordinates[ship].indexOf(e.target.innerText);
                if (index > -1) { // only splice array when item is found
                    currentBoard.coordinates[ship].splice(index, 1); // 2nd parameter means remove one item only
                    console.log("ship removed", currentBoard.coordinates[ship], ship);
                    window.alert("hit");
                }

                // if (currentBoard.coordinates[ship].includes(e.target.innerText)) {
                //     console.log("SHIP HIT");
                // } else {
                //     console.log("MISS")
                // }
            }

            currentBoard.gameOver();
            console.log(currentBoard.board, currentBoard.allOver, "game done?");

            if (currentBoard.allOver && currentBoard.gameSet) {
                window.alert(`${currentBoard.name} loses`);
                // Play again button
                // CODE HERE
            }
            // currentBoard.gameOver();

            console.log(currentBoard.currentShips(), currentBoard.allOver);

            // Check ship health 18th July 2024
            // currentBoard.gameOver()
            // console.log(currentBoard.currentShips(), currentBoard.allOver);
        }

        document.getElementById("battleShips").addEventListener("click", myFunc);
        document.getElementById("battleShipsTwo").addEventListener("click", myFunc);

        // document.getElementById("battleShipsTwo").addEventListener("mouseover", mouseGray);
        // document.getElementById("battleShipsTwo").addEventListener("mouseout", mouseWhite);

        placeTheShips(playerOne, "battleShips", "A1");
        // placeTheShips(playerTwo, "battleShipsTwo", "A1");

        // for (let k = 0; k < 17; k++) {
        //     playerOne.updateState();
        // }



        // while (playerOne.gameSet === false) {
        //     placeTheShips(playerOne, "battleShips", "A1");
        //     playerOne.begin();
        // }

        // placeTheShips(playerTwo, "battleShips", "A1");
        

        // Let's execute these functions only after the ships have been placed
        // document.getElementById("battleShips").addEventListener("mouseover", mouseGray);
        // document.getElementById("battleShips").addEventListener("mouseout", mouseWhite);
        document.getElementById("rotateBtn").addEventListener("click", rotate);
        // document.getElementById("removeBtn").addEventListener("click", removeShip);
        document.getElementById("rematch").addEventListener("click", playAgain);

        function playAgain(e) {
            // reset global variables
            // again = true;
            console.log("play again?")
            turn = true;
            shift = false;
            // playerTwoTurn = false;
            deleteShip = false;
            activeTable = "tableOne";

            // turn every table cell white
            const tableOne = document.getElementById(playerOne.htmlID);
            const tableTwo = document.getElementById(playerTwo.htmlID);
            const cellsOne = tableOne.getElementsByTagName("td");
            const cellsTwo = tableTwo.getElementsByTagName("td");
            
            Array.from(cellsOne).forEach(cell => {
                cell.classList.remove('pink', 'blue', 'white', 'orange', 'gray');
            });

            Array.from(cellsTwo).forEach(cell => {
                cell.classList.remove('pink', 'blue', 'white', 'orange', 'gray');
            });

            clearCoordinates(coords);
            clearCoordinates(shipCoordinates);

            // console.log(coords, shipCoordinates);

            // These objects retain their htmlID
            playerOne.reset();
            playerTwo.reset();

            // Restore state

            playerOne.htmlID = "battleShips";
            playerTwo.htmlID = "battleShipsTwo";

            playerOne.createBoardGame();
            playerTwo.createBoardGame();

            playerOne.place();
            playerTwo.place();

            console.log(playerOne, playerTwo);

            document.getElementById(playerOne.htmlID).removeEventListener("keydown"); // CODE HERE
            // document.getElementById(playerTwo.htmlID).removeEventListener("keydown");

            placeTheShips(playerOne, "battleShips", "A1");

            // document.getElementById("battleShips").addEventListener("click", myFunc);
            // document.getElementById("battleShipsTwo").addEventListener("click", myFunc);
        }


        function red(cell){
            cell.style.background = "pink";

        }

        function turnRed(htmlBoard, val, idx){
            // playerBoard.board[val].ship = true;
            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");
            Array.from(cells).forEach(cell => {
                if (cell.textContent === val) {
                    // cell.style.background = "pink";
                    cell.classList.remove('white')
                    cell.classList.add('pink');
                    // console.log(cell, playerOne.ships, playerTwo.ships, idx);
                }
            });
        }

        function turnBlue(htmlBoard, val){
            // playerBoard.board[val].ship = true;
            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");
            const flat = new Set(val);
            console.log(val);
            Array.from(cells).forEach(cell => {
                // if (cell.textContent === val) {
                if (flat.has(cell.textContent)) {
                    // cell.style.background = "blue";
                    cell.classList.remove('white', 'pink');
                    cell.classList.add('blue');
                    // console.log("yes", cell);
                }
            });
        }

        // function turnRed(htmlBoard, val){
        //     playerBoard.board[val].ship = true;
        //     const table = document.getElementById(htmlBoard);
        //     const cells = table.getElementsByTagName("td");
        //     Array.from(cells).forEach(cell => {
        //         if (cell.textContent === val) {
        //             cell.style.background = "pink"
        //         }
        //     });
        // }

        function highLight(htmlBoard, val){
            // playerBoard.board[val].ship = true;
            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");
            // console.log(val.s)
            Array.from(cells).forEach(cell => {
                if (cell.textContent === val) {
                    cell.style.background = "pink";
                } 
                // else {
                //     cell.style.background = "white";
                // }
            });
        }

        // function shipTherOld(xy, positions, key) {
        //     let occupiedCoordinates = []

        //     for (pos of Object.keys(positions)) {
        //         occupiedCoordinates.push(...positions[pos]);
        //         console.log(positions[pos], "post", occupiedCoordinates);
        //     }

        //     // I'm comparing coordinate list, occupied coordinates
        //     // with coordinate set, xy
        //     const result = xy.some(element => occupiedCoordinates.includes(element));

        //     if (result) {
        //         console.log("Cannot place ship here");
        //         deleteShip = false;
        //     } else {
        //         positions[key].push(...xy);
        //         deleteShip = true;
        //     }

        // }

        function clearCoordinates(obj) {
            Object.keys(obj).forEach(key => {
                obj[key] = [];
            });
        }

        function shipThere(xy, positions, key, player, board) {
            let occupiedCoordinates = []

            for (pos of Object.keys(positions)) {
                occupiedCoordinates.push(...positions[pos]);
                // console.log(positions[pos], "post", occupiedCoordinates);
            }

            console.log("occu", occupiedCoordinates, playerTwo.currentShips());
            if (playerTwo.currentShips() === 0 && playerOne.gameSet) {
                occupiedCoordinates = [];
                clearCoordinates(shipCoordinates);
            }
            console.log("occu", occupiedCoordinates, playerTwo.currentShips(), playerOne.gameSet);
            // I'm comparing coordinate list, occupied coordinates
            // with coordinate set, xy
            // if (playerOne.gameSet === true && playerTwoTurn === false) {
            //     playerTwoTurn = true;
            //     occupiedCoordinates = [];
            //     // code here
            //     clearCoordinates(shipCoordinates);
            //     placeTheShips(playerTwo, "battleShipsTwo", "A1");
            //     activeTable = "tableTwo";
            // }
            const result = xy.some(element => occupiedCoordinates.includes(element));

            if (result) {
                console.log("Cannot place ship here");
                deleteShip = false;
            } else {
                positions[key].push(...xy);
                player.setLocation(key, xy);
                turnBlue(board, xy)
                deleteShip = true;
            }

            player.updateState();
            console.log(playerOne.gameSet, playerTwoTurn, "conditions threshold");

            // if playerOne is done and playerTwo isn't
            if (playerOne.gameSet === true && playerTwoTurn === false) {
                playerTwoTurn = true;
                occupiedCoordinates = [];
                // code here
                clearCoordinates(shipCoordinates);
                placeTheShips(playerTwo, "battleShipsTwo", "A1");
                activeTable = "tableTwo";
            }

            // if (result) {
            //     console.log("Cannot place ship here");
            //     deleteShip = false;
            // } else {
            //     positions[key].push(...xy);
            //     player.setLocation(key, xy);
            //     turnBlue(board, xy)
            //     deleteShip = true;
            // }

            // playerOne.ships["Carrier"] = Number(playerOne.ships["Carrier"]) - 1;
            // console.log(playerOne.coordinates, playerOne.ships, playerOne.healthPoints("Carrier"));
            console.log(playerOne.ships, playerTwo.ships, playerOne.gameSet, playerTwo.gameSet);

            // if (playerOne.gameSet && playerTwo.gameSet) {
            //     hide(playerOne.htmlID);
            //     hide(playerTwo.htmlID);
            // }

            if (player.gameSet) {
                hide(player.htmlID);
            }
        }


        function removeShip() {
            for (ship of Object.keys(playerOne.coordinates)) {
                console.log(ship, playerOne.coordinates[ship]);

                if (playerOne.coordinates[ship].includes("A1")) {
                    console.log("SHIP HERE");
                    // remove or pop off coordinate from ship object
                } else {
                    console.log("no ships here")
                }
            }
        }

        function rotate() {
            // return rotate = true;
            shift = !shift;
            console.log("rotate clicked", shift);
        }
            
        // Ship placement function
        function placeTheShips(playerBoard, htmlBoard, idx) {

            // if (playerOne.gameSet) return

            if (activeTable !== "tableOne") return //
            
            if (playerOne.gameSet && playerTwoTurn === false) return

            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");

            // IF they share the same letters shift => 1
            // ELSE they share the same numbers shift => 1

            // console.log(cells.textContent);
            document.getElementById(playerBoard.htmlID).focus();
            document.getElementById(playerBoard.htmlID).addEventListener("keydown", (e) => {

            // document.addEventListener("keydown", (e) => {
                // console.log(activeTable);

                // console.log(playerOne.gameSet, playerTwo.gameSet);
                Array.from(cells).forEach(cell => {
                    // cell.style.background = "white";
                    cell.classList.remove('pink');
                    cell.classList.add('white');
                });

                switch(event.keyCode) {
                    case 37:
                        // console.log('Left arrow key pressed', idx, String.fromCharCode(idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                        

                        if (shift === false) {

                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] < 75) {
                                // idx = Letter + first number + second number if it exists
                                if (idx[0] === "A") {
                                    idx = String.fromCharCode(idx.charCodeAt(0)) + idx[1] + (idx[2] ? idx[2] : "");

                                } else {
                                    idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");
                                }
                    
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters);
                                }

                            } else {
                                idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");

                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }
                        
                        } else if (shift === true) {

                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - (playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                            }

                            // have to make sure squares are within 1 and 10 and A and J
                            //  75 is 'K'
                            // We are going the downward direction
                            // If conditions are
                            // if letter is not 'K' and square index number + ship length (down direction) is not greater than 11
                            if (idx.charCodeAt(0) >= 66 && Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] <= 11) {
                                // update idx value from e.g. 'A1' to 'B1'
                                idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");

                                //  Iterate ship length
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {

                                    // letters = 'A' + 1 + 1 => 'A1', 'A2', 'A3'
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            } else {

                                idx = "A"+ idx[1] + (idx[2] ? idx[2] : "");

                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                        }

                        break;
                    case 39:
                        // console.log('Right arrow key pressed');


                        if (shift === false) {

                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                idx = String.fromCharCode(idx.charCodeAt(0) - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                                
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                            else if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] < 75) {
                                idx = String.fromCharCode(idx.charCodeAt(0) + 1) + idx[1] + (idx[2] ? idx[2] : "");
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            } else {
                                console.log(idx);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                        // Rotate button is clicked
                        } else if (shift === true) {
                            
                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - (playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                            }

                            if (idx.charCodeAt(0) < 74 && Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] <= 11) {
                                // update idx value from e.g. 'A1' to 'B1'
                                idx = String.fromCharCode(idx.charCodeAt(0) + 1) + idx[1] + (idx[2] ? idx[2] : "");

                                //  Iterate ship length
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {

                                    // letters = 'A' + 1 + 1 => 'A1', 'A2', 'A3'
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            } else {

                                idx = "J"+ idx[1] + (idx[2] ? idx[2] : "");
                                console.log(idx);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                        }

                        break;
                    case 38:
                        // console.log('Up arrow key pressed', idx);


                        if (shift === false) {

                            // if it is too far right
                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                idx = String.fromCharCode(75 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                            }


                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let ref = "";

                                if (Number(idx[2]) === 0) {
                                    ref = 9;
                                } else if (Number(idx[1]) === 1 && Number(idx[2]) !== 0) {
                                    ref = 1;
                                } else {
                                    ref = Number(idx[1]) - 1;
                                }
                            
                                let letters = String.fromCharCode(idx.charCodeAt(0) + j) + ref;
                                turnRed(htmlBoard, letters);
                            }
                        
                            let pick = "";
                            
                            if (Number(idx[2]) === 0) {
                                    pick = 9;
                                } else if (Number(idx[1]) === 1 && Number(idx[2]) !== 0) {
                                    pick = 1;
                                } else {
                                    pick = Number(idx[1]) - 1;
                            }
                            
                            idx = idx[0] + pick;
                        } else if (shift === true) {

                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - (playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                            }

                            console.log("up idx", idx)
                            if (Number(idx[1]) > 1) {
                                idx = idx[0] + (Number(idx[1]) - 1);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) + j)
                                    turnRed(htmlBoard, letters);
                                }
                            } else {
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) + j)
                                    turnRed(htmlBoard, letters);
                                }
                            }

                        }
                        
                        break;
                    case 40:
                        // console.log('Down arrow key pressed', idx);


                        if (shift === false) {

                            // if it is too far right
                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                idx = String.fromCharCode(75 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                            }
                            
                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let letters = String.fromCharCode(idx.charCodeAt(0) + j) + (Number(idx[1]) +  (idx[2] ? idx[2] : Number(1)));
                                turnRed(htmlBoard, letters);
                            }
                        
                            idx = idx[0] + (Number(idx[1]) + (idx[2] ? idx[2] : Number(1)));

                        } else if (shift === true) {

                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - playerBoard.ships[Object.keys(playerBoard.ships)[0]]);
                            }

                            if (Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] < 11) {
                                idx = idx[0] + (Number(idx[1]) + 1);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) +  j);
                                    turnRed(htmlBoard, letters);
                                }
                            } else {
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) +  j);
                                    turnRed(htmlBoard, letters);
                                }
                            }
                            

                        }
                        
                        break;
                    case 13:
                        console.log("Enter pressed", idx);


                        shipCoordinates[Object.keys(playerBoard.ships)[0]] = [];

                        if (shift === false) {

                            let place = []

                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] +  (idx[2] ? idx[2] : "");
                                place.push(letters);
                            }

                            console.log("ship there call", place, shift);
                            shipThere(place, shipCoordinates, Object.keys(playerBoard.ships)[0], playerBoard, htmlBoard);

                            if (deleteShip) {
                                delete playerBoard.ships[Object.keys(playerBoard.ships)[0]];
                            }

                        } else if (shift === true) {

                            let place = [];

                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let letters = idx[0] + (Number(idx[1]) +  j);
                                place.push(letters);
                            }

                            console.log("ship there call", place, shift);
                            shipThere(place, shipCoordinates, Object.keys(playerBoard.ships)[0], playerBoard, htmlBoard);

                            if (deleteShip) {
                                delete playerBoard.ships[Object.keys(playerBoard.ships)[0]];
                            }

                        }

                        // console.log(shipCoordinates, "shipCoordinates");

                        break;
                }

            });

            // playerBoard.currentShips();
            // console.log(playerBoard.currentShips, "Ship Health");
            // return playerBoard.currentShips

            return 1
        }

        // BattleShip cells change background colour on Mouse Hover
        // Only IF ships are already placed
        function mouseGray(e) {
            // console.log(e, "mouseGray called");
            let arena = "";
            let parentNode = "";

            if (e.toElement.nodeName === "TD") {
                if (e.target.parentElement.id.split("-")[0] === "header") {
                    arena = playerOne;
                    parentNode = document.getElementById("battleShips");
                } else if (e.target.parentElement.id.split("-")[0] === "footer") {
                    arena = playerTwo;
                    parentNode = document.getElementById("battleShipsTwo");
                }

                // console.log(arena.shipsPlaced, "DONE")
                
                // If ships are done being put in the board then continue to
                // turn the boards gray
                if (arena.shipsPlaced) {
                    if (arena.board[e.target.innerText].hit !== true) {
                        e.target.style.backgroundColor = "gray";
                    } else {
                        e.target.style.backgroundColor = "black";
                    }
                    console.log("Ships are placed");
                    return
                }
            }
        }


        // BattleShip cells change back to white when mouse is not hovering them
        function mouseWhite(e) {
            // console.log(e, "mouseWhite called");
            let arena = "";
            if (e.fromElement.nodeName === "TD") {
                // console.log(playerOne.board[e.target.innerText], e.target.innerText);
                // console.log(e.target.parentElement.id.split("-")[0]);
                if (e.target.parentElement.id.split("-")[0] === "header") {
                    arena = playerOne;
                } else if (e.target.parentElement.id.split("-")[0] === "footer") {
                    arena = playerTwo;
                }
                if (arena.board[e.target.innerText].hit !== true) {
                    // console.log("Mouse White", playerTwo.board[e.target.innerText].hit, e.target.innerText, playerTwo.board[e.target.innerText]);
                    e.target.style.backgroundColor = "white";
                }
            }
        }



        function rotateShips(playerBoard, htmlBoard, loc, e) {
            // console.log(playerBoard.board, htmlBoard.childNodes[3].childNodes[1].childNodes);            
            let why = false;
            let stop = 20;
            // while (playerBoard.shipsPlaced === false && why > 0) {
            // While player is hovering over the game board
            while (playerBoard.shipsPlaced === false && why === false && stop > 0) {
                playerBoard.updateShipsPlaced();
                // console.log(playerBoard.shipsPlaced, "inner");

                // Iterate through gameboard's ships
                for (const ship of Object.entries(playerBoard.ships)) {
                    // console.log(ship[0], ship[1], "inner loops");
                    // place the ships
                    let shipLength = ship[1];

                    // Iterate through each ship's length
                    for (let j = 0; j < shipLength; j++) {
                        //playerBoardHorizontal
                        let idx = Number(loc[1]) + j;
                        if (idx <= 10 && !playerBoard.board[loc[0]+(idx)].ship) {
                            playerBoard.board[loc[0]+(idx)].ship = true;
                            // console.log(ship[0], "jcole", playerBoard.board[loc[0]+(idx)], loc[0]+(idx), htmlBoard);
                        }
                    }
                }

                stop--;
            }

            delete playerBoard.ships[Object.keys(playerBoard.ships)[0]];
            playerBoard.updateShipsPlaced();
            console.log("SHIP? ", Object.keys(playerBoard.ships)[0], playerOne.ships, Object.getOwnPropertyDescriptor(playerOne.ships, "Patrol"), Object.getOwnPropertyDescriptor(playerBoard.ships, "Patrol"));

            return playerBoard.shipsPlaced
        }
    </script>
</body>
</html>