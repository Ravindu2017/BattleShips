<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Ships</title>
    <style>
        #battleShips {
            border: 2px solid;
            /* width: 500px;
            height: 400px; */
            width: 35vw;
            height: 35vh;
            /* z-index: 1; */
        }

        #battleShipsTwo {
            border: 2px solid;
            /* width: 500px;
            height: 400px; */
            width: 35vw;
            height: 35vh;
            /* z-index: 1; */
        }

        #battleShips th, #battleShips td {
            border: 2px solid;
            padding: 20px;
        }

        #battleShipsTwo th, #battleShipsTwo td {
            border: 2px solid;
            padding: 20px;
        }

        #battleShips th, #battleShipsTwo th {
            background-color: pink;
        }

        #rotateBtn {
            height: 100px;
            width: 150px;
            font-size: x-large;
            float: right;
        }

        #rematch {
            height: 100px;
            width: 150px;
            font-size: x-large;
            float: left;
        }

        .instructions {
            font-size: x-large;
            text-align: center;
            margin: 0 auto;
            width: 50%;
        }

        .white {
            background-color: white;
            background: white;
        }

        .pink {
            background-color: pink;
        }

        .blue {
            background-color: lightblue;
        }

        .orange {
            background-color: orange;
        }

        .lightgray {
            background-color: lightgray;
        }

        .gray {
            background-color: gray;
        }

        .table-container {
            display: flex;
            justify-content: space-around;
        }

        .title {
            font-size: 20px;
        }

        .container {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .score {
            font-size: 50px;
        }

        #hideMe {
            width: 35%;
            height: 35%;
            display: flex;
            background-color: rgba(0, 0, 0, 1);
            z-index: 10;
        }

        #hideMeToo {
            width: 35%;
            height: 35%;
            display: flex;
            background-color: rgba(0, 0, 0, 1);
            z-index: 10;
        }
        
        .modal {
            display: none;
            z-index: 1;
        }

        .modal-content {
            position: absolute;
            top: 30%;
            left: 40%;
            /* transform: translate(-50%, -50%); */
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 20vw;
            height: 20vh;
        }
        
        .modal-buttons button {
            margin: 10px;
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #0400ff;
            color: white;
            font-size: 16px;
        }
        
        .modal-buttons button:hover {
            background-color: #2ab300;
        }

        #playerOneSunkenShips {
            border: 0.5rem solid;
            font-size: 1.5rem;
            width: 7vw;
            overflow: auto;
        }

        #playerTwoSunkenShips {
            border: 0.5rem solid;
            font-size: 1.5rem;
            width: 7vw;
            overflow: auto;
        }

    </style>
    <script src="gamePlan.js"></script>
</head>
<body>

    <div class="container">
        <p class="title">Player One</p>
        <p class="title">Player Two</p>
    </div>

    <div class="table-container">

    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <h2 id="spot">Confirm attack</h2>
            <div class="modal-buttons">
                <button id="yesButton">Attack!</button>
                <button id="noButton">On second thought...</button>
            </div>
        </div>
    </div>

    <div id="revealShipModal" class="modal">
        <div class="modal-content">
            <h2 id="missedASpot">You missed!</h2>
            <div class="modal-buttons">
                <button id="revealButton">Show me my board</button>
            </div>
        </div>
    </div>

    <div id="playerOneSunkenShips">
        Sunken Ships:
        <ol id="playerOneShips"></ol>
    </div>

    <table id="battleShips" tabindex="0">
        <thead>
            <tr>
                <th></th>
                <th>A</th>
                <th>B</th>
                <th>C</th>
                <th>D</th>
                <th>E</th>
                <th>F</th>
                <th>G</th>
                <th>H</th>
                <th>I</th>
                <th>J</th>
            </tr>
        </thead>
        <tbody>
            <tr id="header-1">
                <th>1</th>
                <td>A1</td>
                <td>B1</td>
                <td>C1</td>
                <td>D1</td>
                <td>E1</td>
                <td>F1</td>
                <td>G1</td>
                <td>H1</td>
                <td>I1</td>
                <td>J1</td>
            </tr>
            <tr id="header-2">
                <th>2</th>
                <td>A2</td>
                <td>B2</td>
                <td>C2</td>
                <td>D2</td>
                <td>E2</td>
                <td>F2</td>
                <td>G2</td>
                <td>H2</td>
                <td>I2</td>
                <td>J2</td>
            </tr>
            <tr id="header-3">
                <th>3</th>
                <td>A3</td>
                <td>B3</td>
                <td>C3</td>
                <td>D3</td>
                <td>E3</td>
                <td>F3</td>
                <td>G3</td>
                <td>H3</td>
                <td>I3</td>
                <td>J3</td>
            </tr>
            <tr id="header-4">
                <th>4</th>
                <td>A4</td>
                <td>B4</td>
                <td>C4</td>
                <td>D4</td>
                <td>E4</td>
                <td>F4</td>
                <td>G4</td>
                <td>H4</td>
                <td>I4</td>
                <td>J4</td>
            </tr>
            <tr id="header-5">
                <th>5</th>
                <td>A5</td>
                <td>B5</td>
                <td>C5</td>
                <td>D5</td>
                <td>E5</td>
                <td>F5</td>
                <td>G5</td>
                <td>H5</td>
                <td>I5</td>
                <td>J5</td>
            </tr>
            <tr id="header-6">
                <th>6</th>
                <td>A6</td>
                <td>B6</td>
                <td>C6</td>
                <td>D6</td>
                <td>E6</td>
                <td>F6</td>
                <td>G6</td>
                <td>H6</td>
                <td>I6</td>
                <td>J6</td>
            </tr>
            <tr id="header-7">
                <th>7</th>
                <td>A7</td>
                <td>B7</td>
                <td>C7</td>
                <td>D7</td>
                <td>E7</td>
                <td>F7</td>
                <td>G7</td>
                <td>H7</td>
                <td>I7</td>
                <td>J7</td>
            </tr>
            <tr id="header-8">
                <th>8</th>
                <td>A8</td>
                <td>B8</td>
                <td>C8</td>
                <td>D8</td>
                <td>E8</td>
                <td>F8</td>
                <td>G8</td>
                <td>H8</td>
                <td>I8</td>
                <td>J8</td>
            </tr>
            <tr id="header-9">
                <th>9</th>
                <td>A9</td>
                <td>B9</td>
                <td>C9</td>
                <td>D9</td>
                <td>E9</td>
                <td>F9</td>
                <td>G9</td>
                <td>H9</td>
                <td>I9</td>
                <td>J9</td>
            </tr>
            <tr id="header-10">
                <th>10</th>
                <td>A10</td>
                <td>B10</td>
                <td>C10</td>
                <td>D10</td>
                <td>E10</td>
                <td>F10</td>
                <td>G10</td>
                <td>H10</td>
                <td>I10</td>
                <td>J10</td>
            </tr>
        </tbody>
    </table>

    <!-- </div>   -->
    <!-- hiding div -->

    <div><p></p></div>

    <table id="battleShipsTwo" tabindex="0">
        <thead>
            <tr>
                <th></th>
                <th>A</th>
                <th>B</th>
                <th>C</th>
                <th>D</th>
                <th>E</th>
                <th>F</th>
                <th>G</th>
                <th>H</th>
                <th>I</th>
                <th>J</th>
            </tr>
        </thead>
        <tbody>
            <tr id="footer-1">
                <th>1</th>
                <td>A1</td>
                <td>B1</td>
                <td>C1</td>
                <td>D1</td>
                <td>E1</td>
                <td>F1</td>
                <td>G1</td>
                <td>H1</td>
                <td>I1</td>
                <td>J1</td>
            </tr>
            <tr id="footer-2">
                <th>2</th>
                <td>A2</td>
                <td>B2</td>
                <td>C2</td>
                <td>D2</td>
                <td>E2</td>
                <td>F2</td>
                <td>G2</td>
                <td>H2</td>
                <td>I2</td>
                <td>J2</td>
            </tr>
            <tr id="footer-3">
                <th>3</th>
                <td>A3</td>
                <td>B3</td>
                <td>C3</td>
                <td>D3</td>
                <td>E3</td>
                <td>F3</td>
                <td>G3</td>
                <td>H3</td>
                <td>I3</td>
                <td>J3</td>
            </tr>
            <tr id="footer-4">
                <th>4</th>
                <td>A4</td>
                <td>B4</td>
                <td>C4</td>
                <td>D4</td>
                <td>E4</td>
                <td>F4</td>
                <td>G4</td>
                <td>H4</td>
                <td>I4</td>
                <td>J4</td>
            </tr>
            <tr id="footer-5">
                <th>5</th>
                <td>A5</td>
                <td>B5</td>
                <td>C5</td>
                <td>D5</td>
                <td>E5</td>
                <td>F5</td>
                <td>G5</td>
                <td>H5</td>
                <td>I5</td>
                <td>J5</td>
            </tr>
            <tr id="footer-6">
                <th>6</th>
                <td>A6</td>
                <td>B6</td>
                <td>C6</td>
                <td>D6</td>
                <td>E6</td>
                <td>F6</td>
                <td>G6</td>
                <td>H6</td>
                <td>I6</td>
                <td>J6</td>
            </tr>
            <tr id="footer-7">
                <th>7</th>
                <td>A7</td>
                <td>B7</td>
                <td>C7</td>
                <td>D7</td>
                <td>E7</td>
                <td>F7</td>
                <td>G7</td>
                <td>H7</td>
                <td>I7</td>
                <td>J7</td>
            </tr>
            <tr id="footer-8">
                <th>8</th>
                <td>A8</td>
                <td>B8</td>
                <td>C8</td>
                <td>D8</td>
                <td>E8</td>
                <td>F8</td>
                <td>G8</td>
                <td>H8</td>
                <td>I8</td>
                <td>J8</td>
            </tr>
            <tr id="footer-9">
                <th>9</th>
                <td>A9</td>
                <td>B9</td>
                <td>C9</td>
                <td>D9</td>
                <td>E9</td>
                <td>F9</td>
                <td>G9</td>
                <td>H9</td>
                <td>I9</td>
                <td>J9</td>
            </tr>
            <tr id="footer-10">
                <th>10</th>
                <td>A10</td>
                <td>B10</td>
                <td>C10</td>
                <td>D10</td>
                <td>E10</td>
                <td>F10</td>
                <td>G10</td>
                <td>H10</td>
                <td>I10</td>
                <td>J10</td>
            </tr>
        </tbody>
    </table>
    <!-- </div> -->

    <!-- hiding div -->
    <div id="playerTwoSunkenShips">
        Sunken Ships:
        <ol id="playerTwoShips"></ol>
    </div>

    </div>

    <div>
        <h2 class="instructions">
            To play the game, use arrow keys to place ships on your respective board.
            Click on the table headings (coloured in pink) to focus on the board in
            order to place your ships. Clicking other buttons such as 'Play Again' or
            'rotate' causes the boards to lose focus. Simply click the table headings
            again to regain focus in order to place ships.
    
            Player One starts. To rotate the ship placement, click the rotate button. 
            Once 5 ships are placed on Player One's board, it is time for Player Two
            to place their 5 ships.

            Press 'ENTER' to place a ship.

            Once ships are placed, Player One may begin by firing on Player Two's board.
            After the initial attack the board will become visible again after two seconds.
            Player Two can see the status of their board and return the gesture to Player One.
            The board getting attacked will be visible two seconds after the attack.
            Take your time and ENJOY!
        </h2>
    </div>

    <div>
        <button id="rotateBtn" type="button" style="font-size: large;">
            rotate
        </button>


        <button id="rematch" type="button" style="font-size: large;">
            Play Again?
        </button>
    </div>
    <div class="container">
        <p id="hitOrmiss" class="score"></p>
    </div>
    <script>
        // Global Variables
        // if turn is true then it is player One's turn
        let turn = true;
        let shift = false; // shift = true = vertical
        let playerTwoTurn = false;
        let activeTable = "tableOne";
        const shipStatus = document.getElementById("hitOrmiss");
        const playerOneStatus = document.getElementById("playerOneShips");
        const playerTwoStatus = document.getElementById("playerTwoShips");

        const playerOneShips = {
            "Carrier":      0,
            "Battleship":   0,
            "Destroyer":    0,
            "Submarine":    0,
            "Patrol":       0,
        }

        const playerTwoShips = {
            "Carrier":      0,
            "Battleship":   0,
            "Destroyer":    0,
            "Submarine":    0,
            "Patrol":       0,
        }

        const coords = {
            "Carrier":      [],
            "Battleship":   [],
            "Destroyer":    [],
            "Submarine":    [],
            "Patrol":       [],
        }

        const shipCoordinates = {
            "Carrier":      [],
            "BattleShip":   [],
            "Destroyer":    [],
            "Submarine":    [],
            "Patrol":       [],
        };
        
        let deleteShip = false;

        const playerOne = new Gameboard();
        const playerTwo = new Gameboard();

        console.log(playerOne, playerTwo, "begininning");

        playerOne.htmlID = "battleShips";
        playerTwo.htmlID = "battleShipsTwo";

        playerOne.createBoardGame();
        playerTwo.createBoardGame();

        playerOne.place();
        playerTwo.place();

        function hide(ID){
            const table = document.getElementById(ID);
            const cells = table.getElementsByTagName("td");
            
            Array.from(cells).forEach(cell => {
                cell.classList.add('gray');
            });
        }


        // Maybe remove this
        function blackOut(ID) {
            const table = document.getElementById(ID);
            const tableCells = table.getElementsByTagName("td");
            Array.from(tableCells).forEach(cell => {
                cell.classList.add('gray');
            });
        }

        
        // modal function
        function attackModal() {
            return new Promise((resolve) => {
            const modal = document.getElementById('confirmationModal');
            modal.style.display = 'block'; // Show the modal

            // Get buttons
            const yesButton = document.getElementById('yesButton');
            const noButton = document.getElementById('noButton');

            // Handle Yes click
            yesButton.onclick = function() {
                modal.style.display = 'none'; // Hide the modal
                resolve(true); // Resolve the promise with true
            };

            // Handle No click
            noButton.onclick = function() {
                modal.style.display = 'none'; // Hide the modal
                resolve(false); // Resolve the promise with false
            };
            });
        }

        // modal function
        function revealModal() {
            return new Promise((resolve) => {
            const modal = document.getElementById('revealShipModal');
            modal.style.display = 'block'; // Show the modal

            // Get buttons
            const yesButton = document.getElementById('revealButton');

            // Handle Yes click
            yesButton.onclick = function() {
                modal.style.display = 'none'; // Hide the modal
                resolve(true); // Resolve the promise with true
            };
            });
        }

        async function attackConfirm() {
            const userConfirmed = await attackModal();
            let conf = true;
            
            if (userConfirmed) {
            } else {
                conf = false;
            }

            return conf
        }

        async function revealShipConfirm() {
            const userConfirmed = await revealModal();
            let confirmation = true;
            
            if (userConfirmed) {
            } else {
                console.log("edge case");
                confirmation = false;
            }

            return confirmation
        }

        function shipWreck(e, shipLocation, shipName) {
            let shipHit = false;
            for (ship of Object.keys(shipLocation)) {
                const index = shipLocation[ship].indexOf(e.target.innerText);
                if (index > -1) { // only splice array when item is found
                    shipLocation[ship].splice(index, 1); // 2nd parameter means remove one item only
                    if (shipName === "Player One" && shipLocation[ship].length === 0) {
                        const li = document.createElement('li');
                        li.textContent = ship;
                        playerOneStatus.appendChild(li);
                        playerOneShips[ship] = 1;
                    } else if (shipName === "Player Two" && shipLocation[ship].length === 0) {
                        const li = document.createElement('li');
                        li.textContent = ship;
                        playerTwoStatus.appendChild(li);
                        playerTwoShips[ship] = 1;
                    }
                    shipHit = true;
                }
            }
            return shipHit
        }

        // game function
        async function myFunc(e){
            // change this function to only work
            // after all ships have been placed
            if (e.target.classList.contains('orange') || e.target.classList.contains('lightgray')) {
                shipStatus.innerText = "This position has already been hit";
                shipStatus.style.color = "Orange";
                return
            }

            if (!playerTwo.gameSet) {
                return
            }

            if (playerOne.allOver) {
                return
            }
            
            if (playerTwo.allOver) {
                return
            }

            // console.log(e.toElement, e);
            if (!(e.target.nodeName === "TD")) {
                return
            }

            // decide whose turn it is to play
            // turn value is switched and clicked element is checked to make sure
            // opponent board is clicked on
            // such that it is player ONE's turn and they are clicking on player TWO's board
            // after check switch turn value so it is the next player's turn
            if (!turn && e.target.parentElement.id.split("-")[0] === "header") { 
                turn = true;
            } else if (turn && e.target.parentElement.id.split("-")[0] === "footer") {
                turn = false;
            } else {
                console.log(turn, "..no?...");
                return;
            }

            // const location = new Position();
            const depth = e.target.parentElement.id.split("-");
            // if e.target.classList has orange just pop up that the spot has
            // already been hit
            // e.target.classList.add("orange"); // CODE HERE
            // console.log(e, e.target.color, depth[0]);
            let currentBoard = "";
            let opponent = "";
            let opponentName = "";

            if (depth[0] === "header") {
                currentBoard = playerOne;
                currentBoard.name = "Player One";
                opponent = playerTwo;
                opponentName = "Player Two";
            } else if (depth[0] === "footer") {
                currentBoard = playerTwo;
                currentBoard.name = "Player Two";
                opponent = playerOne;
                opponentName = "Player One";
            }

            const tableTop = document.getElementById(currentBoard.htmlID);
            const cells = tableTop.getElementsByTagName("td");

            const enemyTable = document.getElementById(opponent.htmlID);
            const enemyCells = enemyTable.getElementsByTagName("td");
            
            // Improve hiding with a proceed function
            tableTop.style.backgroundColor = "rgba(0, 0, 0, 0)";

            // 22nd October 2024 move this below the ship hit function
            // this should be called once current player is ready to attack
            // const conf = confirm("Do you wish to attack?");
            document.getElementById("spot").innerText = `Confirm attack on ${e.target.innerText}`;
            const conf = await attackConfirm();
            // console.log("CONF", conf);
            if (conf) {
                // need to handle wait button since that adds gray class by default or could be because I am nesting my promises
                let shipHit = shipWreck(e, currentBoard.coordinates, currentBoard.name);
                if (shipHit == true) {
                    shipStatus.innerText = "HIT!";
                    shipStatus.style.color = "Green";
                    e.target.classList.add("orange");
                    turn = !turn;
                } else {
                    // call method for modal pop up to reveal current player board
                    shipStatus.innerText = "MISS!";
                    shipStatus.style.color = "Red";
                    document.getElementById("missedASpot").innerText = `${opponentName} missed on ${e.target.innerText}`;
                    document.getElementById("revealButton").innerText = `Show me my (${currentBoard.name}) board`;
                    const shipConf = await revealShipConfirm();
                    if (shipConf) {
                        Array.from(cells).forEach(cell => {
                            cell.classList.remove('gray');
                            e.target.classList.add("lightgray");
                        });
                    }
                    // setTimeout(() => {
                    //     // console.log("Opponent Attacking");
                    //     Array.from(cells).forEach(cell => {
                    //     // remove overlay
                    //     cell.classList.remove('gray');
                    //     e.target.classList.add("lightgray");
                    // });
                    // }, 2000);
                }
            } else if (conf === false) { // on second though button clicked
                turn = !turn;
                return
            }
            

            Array.from(enemyCells).forEach(cell => {
                cell.classList.add('gray');
                // remove overlay
            });
            

            enemyTable.style.background.Color = "rgba(0, 0, 0, 1)";

            currentBoard.board[e.target.innerText].hit = true;
            console.log(`Position ${e.target.innerText} has been hit!`);

            currentBoard.gameOver();
            // console.log(currentBoard.board, currentBoard.allOver, "game done?");

            if (currentBoard.allOver && currentBoard.gameSet) {
                window.alert(`${currentBoard.name} loses`);
                // Play again button
                // CODE HERE
            }

        }

        document.getElementById("battleShips").addEventListener("click", myFunc);
        document.getElementById("battleShipsTwo").addEventListener("click", myFunc);


        placeTheShips(playerOne, "battleShips", "A1");

        document.getElementById("rematch").addEventListener("click", playAgain);

        function playAgain(e) {
            // reset global variables
            // again = true;
            console.log("play again?")
            turn = true;
            shift = false;
            // playerTwoTurn = false;
            deleteShip = false;
            activeTable = "tableOne";

            // turn every table cell white
            const tableOne = document.getElementById(playerOne.htmlID);
            const tableTwo = document.getElementById(playerTwo.htmlID);
            const cellsOne = tableOne.getElementsByTagName("td");
            const cellsTwo = tableTwo.getElementsByTagName("td");
            
            Array.from(cellsOne).forEach(cell => {
                cell.classList.remove('pink', 'blue', 'white', 'orange', 'gray', 'lightgray');
            });

            Array.from(cellsTwo).forEach(cell => {
                cell.classList.remove('pink', 'blue', 'white', 'orange', 'gray', 'lightgray');
            });

            clearCoordinates(coords);
            clearCoordinates(shipCoordinates);

            // console.log(coords, shipCoordinates);

            // These objects retain their htmlID
            playerOne.reset();
            playerTwo.reset();

            // Restore state
            playerOne.htmlID = "battleShips";
            playerTwo.htmlID = "battleShipsTwo";

            playerOne.createBoardGame();
            playerTwo.createBoardGame();

            playerOne.place();
            playerTwo.place();

            console.log(playerOne, playerTwo);

            document.getElementById(playerOne.htmlID).removeEventListener("keydown");

            placeTheShips(playerOne, "battleShips", "A1");

        }


        function red(cell){
            cell.style.background = "pink";

        }

        function turnRed(htmlBoard, val, idx){
            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");
            Array.from(cells).forEach(cell => {
                if (cell.textContent === val) {
                    cell.classList.remove('white')
                    cell.classList.add('pink');
                    // console.log(cell, playerOne.ships, playerTwo.ships, idx);
                }
            });
        }

        function turnBlue(htmlBoard, val){
            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");
            const flat = new Set(val);
            // console.log(val);
            Array.from(cells).forEach(cell => {
                if (flat.has(cell.textContent)) {
                    cell.classList.remove('white', 'pink');
                    cell.classList.add('blue');
                }
            });
        }

        function clearCoordinates(obj) {
            Object.keys(obj).forEach(key => {
                obj[key] = [];
            });
        }

        function shipThere(xy, positions, key, player, board) {
            let occupiedCoordinates = []

            for (pos of Object.keys(positions)) {
                occupiedCoordinates.push(...positions[pos]);
                // console.log(positions[pos], "post", occupiedCoordinates);
            }

            // console.log("occu", occupiedCoordinates, playerTwo.currentShips());
            
            if (playerTwo.currentShips() === 0 && playerOne.gameSet) {
                occupiedCoordinates = [];
                clearCoordinates(shipCoordinates);
            }
            
            // console.log("occu", occupiedCoordinates, playerTwo.currentShips(), playerOne.gameSet);

            const result = xy.some(element => occupiedCoordinates.includes(element));

            if (result) {
                // console.log("Cannot place ship here");
                deleteShip = false;
            } else {
                positions[key].push(...xy);
                player.setLocation(key, xy);
                turnBlue(board, xy)
                deleteShip = true;
            }

            player.updateState();

            // console.log(playerOne.gameSet, playerTwoTurn, "conditions threshold");

            // if playerOne is done and playerTwo isn't
            if (playerOne.gameSet === true && playerTwoTurn === false) {
                playerTwoTurn = true;
                occupiedCoordinates = [];
                clearCoordinates(shipCoordinates);
                placeTheShips(playerTwo, "battleShipsTwo", "A1");
                activeTable = "tableTwo";
            }

            // console.log(playerOne.ships, playerTwo.ships, playerOne.gameSet, playerTwo.gameSet);

            if (player.gameSet) {
                hide(player.htmlID);
            }
        }


        function removeShip() {
            for (ship of Object.keys(playerOne.coordinates)) {
                console.log(ship, playerOne.coordinates[ship]);

                if (playerOne.coordinates[ship].includes("A1")) {
                    console.log("SHIP HERE");
                    // remove or pop off coordinate from ship object
                } else {
                    console.log("no ships here")
                }
            }
        }

        function rotate() {
            shift = !shift;
            // console.log("rotate clicked", shift);
        }
            
        // Ship placement function
        function placeTheShips(playerBoard, htmlBoard, idx) {

            if (activeTable !== "tableOne") return
            
            if (playerOne.gameSet && playerTwoTurn === false) return

            const table = document.getElementById(htmlBoard);
            const cells = table.getElementsByTagName("td");

            // IF they share the same letters shift => 1
            // ELSE they share the same numbers shift => 1

            document.getElementById(playerBoard.htmlID).focus();
            document.getElementById(playerBoard.htmlID).addEventListener("keydown", (e) => {

                if (e.key === "r" || e.key === "R") {
                    shift = !shift;
                }

                Array.from(cells).forEach(cell => {
                    cell.classList.remove('pink');
                    cell.classList.add('white');
                });

                switch(event.keyCode) {
                    case 37:
                        // console.log('Left arrow key pressed', idx, String.fromCharCode(idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));


                        if (shift === false) {
                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] < 75) {
                                // idx = Letter + first number + second number if it exists
                                if (idx[0] === "A") {
                                    idx = String.fromCharCode(idx.charCodeAt(0)) + idx[1] + (idx[2] ? idx[2] : "");

                                } else {
                                    idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");
                                }
                    
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters);
                                }

                            } else {
                                idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");

                                if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                    idx = String.fromCharCode(75 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                                    for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                        let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                        turnRed(htmlBoard, letters, idx);
                                    }
                                } else {
                                    for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                        let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                        turnRed(htmlBoard, letters, idx);
                                    }
                                }
                            }
                        } else if (shift === true) {
                            
                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - (playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                            }

                            // have to make sure squares are within 1 and 10 and A and J
                            //  75 is 'K'
                            // We are going the downward direction
                            // If conditions are
                            // if letter is not 'K' and square index number + ship length (down direction) is not greater than 11
                            if (idx.charCodeAt(0) >= 66 && Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] <= 11) {
                                // update idx value from e.g. 'A1' to 'B1'
                                idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");

                                //  Iterate ship length
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {

                                    // letters = 'A' + 1 + 1 => 'A1', 'A2', 'A3'
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            } else {
                                if (idx[0] == "A") {
                                    idx = "A" + idx[1] + (idx[2] ? idx[2] : "");
                                } else {
                                    idx = String.fromCharCode(idx.charCodeAt(0) - 1) + idx[1] + (idx[2] ? idx[2] : "");
                                }

                                if (playerBoard.ships[Object.keys(playerBoard.ships)[0]] + Number(idx[1]) > 10) {
                                    idx = idx[0] + (11 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]).toString();
                                }

                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                        }

                        break;
                    case 39:
                        // console.log('Right arrow key pressed');

                       
                        if (shift === false) {

                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                idx = String.fromCharCode(idx.charCodeAt(0) - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                                
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                            else if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] < 75) {
                                idx = String.fromCharCode(idx.charCodeAt(0) + 1) + idx[1] + (idx[2] ? idx[2] : "");
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            } else {
                                console.log(idx);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] + (idx[2] ? idx[2] : "");
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                        // Rotate button is clicked
                        } else if (shift === true) {
                            
                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - (playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                            }

                            if (idx.charCodeAt(0) < 74 && Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] <= 11) {
                                // update idx value from e.g. 'A1' to 'B1'
                                idx = String.fromCharCode(idx.charCodeAt(0) + 1) + idx[1] + (idx[2] ? idx[2] : "");

                                //  Iterate ship length
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {

                                    // letters = 'A' + 1 + 1 => 'A1', 'A2', 'A3'
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            } else {
                                if (idx.charCodeAt(0) < 74) {
                                    idx = String.fromCharCode(idx.charCodeAt(0) + 1) + idx[1] + (idx[2] ? idx[2] : "");
                                    console.log("HUH")
                                } else {
                                    idx = "J"+ idx[1] + (idx[2] ? idx[2] : "");
                                }


                                if (Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 11) { // index A8 -> 8 + 5 = 13
                                    console.log("in right key", idx, playerBoard.ships[Object.keys(playerBoard.ships)[0]], "<- ship length")
                                    for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                        let letters = idx[0] + ((11 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) +  j);
                                        turnRed(htmlBoard, letters);
                                        console.log("letters", letters);
                                    }
                                }
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = String.fromCharCode(idx.charCodeAt(0)) + (Number(idx[1]) + j);
                                    turnRed(htmlBoard, letters, idx);
                                }
                            }

                        }

                        break;
                    case 38:
                        // console.log('Up arrow key pressed', idx);


                        if (shift === false) {

                            // if it is too far right
                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                idx = String.fromCharCode(75 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                            }


                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let ref = "";

                                if (Number(idx[2]) === 0) {
                                    ref = 9;
                                } else if (Number(idx[1]) === 1 && Number(idx[2]) !== 0) {
                                    ref = 1;
                                } else {
                                    ref = Number(idx[1]) - 1;
                                }
                            
                                let letters = String.fromCharCode(idx.charCodeAt(0) + j) + ref;
                                turnRed(htmlBoard, letters);
                            }
                        
                            let pick = "";
                            
                            if (Number(idx[2]) === 0) {
                                    pick = 9;
                                } else if (Number(idx[1]) === 1 && Number(idx[2]) !== 0) {
                                    pick = 1;
                                } else {
                                    pick = Number(idx[1]) - 1;
                            }
                            
                            idx = idx[0] + pick;
                        } else if (shift === true) {

                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - (playerBoard.ships[Object.keys(playerBoard.ships)[0]] - 1));
                            }

                            console.log("up idx", idx)
                            if (Number(idx[1]) > 1) {
                                idx = idx[0] + (Number(idx[1]) - 1);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) + j)
                                    turnRed(htmlBoard, letters);
                                }
                            } else {
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) + j)
                                    turnRed(htmlBoard, letters);
                                }
                            }

                        }
                        
                        break;
                    case 40:
                        // console.log('Down arrow key pressed', idx);


                        if (shift === false) {

                            // if it is too far right
                            if (idx.charCodeAt(0) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 75) {
                                idx = String.fromCharCode(75 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) + idx[1] + (idx[2] ? idx[2] : "");
                            }
                            
                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let letters = String.fromCharCode(idx.charCodeAt(0) + j) + (Number(idx[1]) +  (idx[2] ? idx[2] : Number(1)));
                                turnRed(htmlBoard, letters);
                            }
                        
                            idx = idx[0] + (Number(idx[1]) + (idx[2] ? idx[2] : Number(1)));

                        } else if (shift === true) {

                            if (idx[2] === "0") {
                                idx = idx[0] + (Number(idx[1]+idx[2]) - playerBoard.ships[Object.keys(playerBoard.ships)[0]]);
                            }

                            if (Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] < 11) {
                                idx = idx[0] + (Number(idx[1]) + 1);
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) +  j);
                                    turnRed(htmlBoard, letters);
                                }
                            } else if (Number(idx[1]) + playerBoard.ships[Object.keys(playerBoard.ships)[0]] > 11) { // index A8 -> 8 + 5 = 13
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + ((11 - playerBoard.ships[Object.keys(playerBoard.ships)[0]]) +  j);
                                    turnRed(htmlBoard, letters);
                                }
                            } else {
                                for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                    let letters = idx[0] + (Number(idx[1]) +  j);
                                    turnRed(htmlBoard, letters);
                                }
                            }
                            

                        }
                        
                        break;
                    case 13:
                        // console.log("Enter pressed", idx);


                        shipCoordinates[Object.keys(playerBoard.ships)[0]] = [];

                        if (shift === false) {

                            let place = []

                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let letters = String.fromCharCode(idx.charCodeAt(0) + j) + idx[1] +  (idx[2] ? idx[2] : "");
                                place.push(letters);
                            }

                            // console.log("ship there call", place, shift);
                            shipThere(place, shipCoordinates, Object.keys(playerBoard.ships)[0], playerBoard, htmlBoard);

                            if (deleteShip) {
                                delete playerBoard.ships[Object.keys(playerBoard.ships)[0]];
                            }

                        } else if (shift === true) {

                            let place = [];

                            for (let j = 0; j < playerBoard.ships[Object.keys(playerBoard.ships)[0]]; j++) {
                                let letters = idx[0] + (Number(idx[1]) +  j);
                                place.push(letters);
                            }

                            console.log("ship there call", place, shift);
                            shipThere(place, shipCoordinates, Object.keys(playerBoard.ships)[0], playerBoard, htmlBoard);

                            if (deleteShip) {
                                delete playerBoard.ships[Object.keys(playerBoard.ships)[0]];
                            }

                        }

                        // console.log(shipCoordinates, "shipCoordinates");

                        break;
                }

            });

            // playerBoard.currentShips();
            // console.log(playerBoard.currentShips, "Ship Health");
            // return playerBoard.currentShips

            return 1
        }

    </script>
</body>
</html>